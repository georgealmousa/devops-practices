
stages:
  - build
  - docker

before_script:
  - echo "--------- STARTING WORK ------------"
  - sh script.sh 

package the maven project:
  stage: build
  script:
  - version=`sh script.sh` 
  - sed -i "s/%%VERSION%%/"$version"/" pom.xml 
  - mvn versions:set -DnewVersion=$version
  - mvn clean package 
  tags:
    - george  
  allow_failure: false
  artifacts:
    paths:
      - target/*.jar 

build the docker image:
  stage: docker
  script:
    - version=`sh script.sh`
    - docker login -u georgemusa -p $docker_pass 
    - docker build -t georgealmousa/assignment:$version .
    - docker push georgealmousa/assignment:$version
  tags:
    - george 
  artifacts:  
    paths:
      - target/*.jar 